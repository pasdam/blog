<!doctype html><html lang=en><head><meta charset=utf-8><title>Install DataDog Agent as a docker container &ndash; /dev/null
</title><link href="https://fonts.googleapis.com/css?family=Work+Sans:600|Quattrocento+Sans:400,400i,700" rel=stylesheet type=text/css><link rel=icon href=https://pasdam.github.io/blog/favicon.svg><link rel=stylesheet href=https://pasdam.github.io/blog/global.min.css><meta name=description content="Tutorial on how to collect metrics using the DataDog agent, running locally in a docker container"><meta name=viewport content="width=device-width,initial-scale=1"><script async src="https://www.googletagmanager.com/gtag/js?id=G-H52BY7123V"></script><script async src=https://pasdam.github.io/blog/copy-code-button.min.js onload='setupCopyButtons("copy","copied!")'></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-H52BY7123V",{cookie_domain:"pasdam.github.io",cookie_flags:"SameSite=None;Secure"})</script><link href=https://cdn.jsdelivr.net/npm/shareon@2/dist/shareon.min.css rel=stylesheet><script src=https://cdn.jsdelivr.net/npm/shareon@2/dist/shareon.iife.js defer init></script></head><body><header id=page-header class=bg-green><a href=https://pasdam.github.io/blog/><h1>/dev/null</h1></a></header><div id=main><article class=post-body><h1 class=text-green>Install DataDog Agent as a docker container</h1><p class=date-read-time>November 23, 2018 &mdash; 2 Min Read</p><div class=tags><div class=tag><a href=/blog/tags/cloud/ class=test>Cloud</a></div><div class=tag><a href=/blog/tags/datadog/ class=test>DataDog</a></div><div class=tag><a href=/blog/tags/docker/ class=test>Docker</a></div><div class=tag><a href=/blog/tags/metrics/ class=test>Metrics</a></div><div class=tag><a href=/blog/tags/monitoring/ class=test>Monitoring</a></div></div><hr><nav id=TableOfContents><ul><li><a href=#requirements>Requirements</a></li><li><a href=#setup-docker-container>Setup docker container</a></li><li><a href=#test-the-agent>Test the agent</a></li></ul></nav><hr><div class=content><p><a href=https://www.datadoghq.com/>DataDog</a> is a monitoring service for cloud-scale applications, in the following guide we&rsquo;ll see how to create a docker container with the <a href="https://docs.datadoghq.com/agent/?tab=agentv6">DataDog agent</a> and how to use it to publish custom metrics.</p><h2 id=requirements>Requirements</h2><p>In the following article we assume that yuo have:</p><ul><li>a <a href=https://www.datadoghq.com/>DataDog</a> account with a valid API key; you can get the key from <a href=https://app.datadoghq.com/account/settings#api>Integrations > API</a>;</li><li><a href=https://docs.docker.com/install/>Docker installed</a>.</li></ul><h2 id=setup-docker-container>Setup docker container</h2><p>As first thing, we create an environment variable that we&rsquo;ll use to pass the API key to the docker container:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>DD_API_KEY<span style=color:#f92672>=</span>&lt;API_KEY&gt;
</span></span></code></pre></div><p>Then we run the container with the agent with:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker run --rm -d -v /var/run/docker.sock:/var/run/docker.sock:ro -v /proc/:/host/proc/:ro -v /sys/fs/cgroup/:/host/sys/fs/cgroup:ro -e DD_API_KEY<span style=color:#f92672>=</span>$DD_API_KEY --name dd-agent datadog/agent:latest
</span></span></code></pre></div><p>The previous command should be enough for the most common cases, but if for specific reasons you need to send metrics from your host machine to the <a href="https://docs.datadoghq.com/agent/?tab=agentv6">DataDog agent</a>, you should run the following:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ docker run <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --rm <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  -d <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  -v /var/run/docker.sock:/var/run/docker.sock:ro <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  -v /proc/:/host/proc/:ro <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  -v /sys/fs/cgroup/:/host/sys/fs/cgroup:ro <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  -e DD_API_KEY<span style=color:#f92672>=</span>$DD_API_KEY <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  -e DD_DOGSTATSD_NON_LOCAL_TRAFFIC<span style=color:#f92672>=</span>true <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  -p 8125:8125/udp <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --name dd-agent <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  datadog/agent:latest
</span></span></code></pre></div><p>This way the container port is exposed to the local machine.</p><p>You can refer to the <a href=https://docs.datadoghq.com/agent/basic_agent_usage/docker/>official documentation</a> for more specific configurations.</p><h2 id=test-the-agent>Test the agent</h2><p>In order to test if the agent works properly we&rsquo;re going to <a href=https://help.datadoghq.com/hc/en-us/articles/206441345-Send-metrics-and-events-using-dogstatsd-and-the-shell>send a custom metric from the command line</a>.</p><p>If the container exposes the port to the host, it is possible to use one the following:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># Linux</span>
</span></span><span style=display:flex><span>echo -n <span style=color:#e6db74>&#34;custom_metric:20|g|#shell&#34;</span> &gt; /dev/udp/localhost/8125
</span></span><span style=display:flex><span><span style=color:#75715e># macOS</span>
</span></span><span style=display:flex><span>echo -n <span style=color:#e6db74>&#34;custom_metric:20|g|#shell&#34;</span> | nc -4u -w0 localhost <span style=color:#ae81ff>8125</span>
</span></span></code></pre></div><p>It is also possible to send a metric from within the container itself:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># open a shell in the container</span>
</span></span><span style=display:flex><span>docker exec -i -t dd-agent /bin/bash
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># send the custom metrics using the container&#39;s shell</span>
</span></span><span style=display:flex><span>echo -n <span style=color:#e6db74>&#34;custom_metric:20|g|#shell&#34;</span> &gt; /dev/udp/localhost/8125
</span></span></code></pre></div></div></article></div><hr><div class=socialshare><p>Share this</p><div class=shareon><a class=facebook title="Share on Facebook"></a><a class=linkedin title="Share on Linkedin"></a><a class=mastodon title="Share on Mastodon"></a><a class=messenger data-fb-app-id=0123456789012345 title="Share on Messenger"></a><a class=pinterest title="Share on Pinterest"></a><a class=pocket title="Share on Pocket"></a><a class=reddit title="Share on Reddit"></a><a class=telegram title="Share on Telegram"></a><a class=twitter title="Share on Twitter"></a><a class=vkontakte title="Share on Vkontakte"></a><a class=whatsapp title="Share on Whatsapp"></a><a class=copy-url title="Copy link"></a><a class=email title="Share by Email"></a><a class=print title=Print></a></div></div><hr><div id=disqus_thread></div><script>(function(){var e=document,t=e.createElement("script");t.src="https://pasdam-github-io.disqus.com/embed.js",t.setAttribute("data-timestamp",+new Date),(e.head||e.body).appendChild(t)})()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments.</a></noscript><button class=hidden id=to-top-button onclick=goToTop() title="Go To Top">
<svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="chevron-circle-up" role="img" viewBox="0 0 512 512"><path fill="currentcolor" d="M8 256C8 119 119 8 256 8s248 111 248 248-111 248-248 248S8 393 8 256zm231-113.9L103.5 277.6c-9.4 9.4-9.4 24.6.0 33.9l17 17c9.4 9.4 24.6 9.4 33.9.0L256 226.9l101.6 101.6c9.4 9.4 24.6 9.4 33.9.0l17-17c9.4-9.4 9.4-24.6.0-33.9L273 142.1c-9.4-9.4-24.6-9.4-34 0z"/></svg>
</button>
<script async>const offset=100;var toTopButton=document.getElementById("to-top-button");window.onscroll=function(){document.body.scrollTop>offset||document.documentElement.scrollTop>offset?toTopButton.classList.remove("hidden"):toTopButton.classList.add("hidden")};function goToTop(){window.scrollTo({top:0,behavior:"smooth"})}</script></body></html>