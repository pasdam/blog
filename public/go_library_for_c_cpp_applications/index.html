<!doctype html><html lang=en><head><meta charset=utf-8><title>Use Go code in c/c++ applications &ndash; /dev/null
</title><link href="https://fonts.googleapis.com/css?family=Work+Sans:600|Quattrocento+Sans:400,400i,700" rel=stylesheet type=text/css><link rel=icon href=https://pasdam.github.io/blog/favicon.svg><link rel=stylesheet href=https://pasdam.github.io/blog/global.min.css><meta name=description content="Tutorial to show how to call Go code from a c/c++ application"><meta name=viewport content="width=device-width,initial-scale=1"><script async src="https://www.googletagmanager.com/gtag/js?id=G-H52BY7123V"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-H52BY7123V",{cookie_flags:"SameSite=None;Secure"})</script></head><body><header id=page-header class=bg-green><a href=https://pasdam.github.io/blog/><h1>/dev/null</h1></a></header><div id=main><div class=post-body><h1 class=text-green>Use Go code in c/c++ applications</h1><p class=date-read-time>April 27, 2019 &mdash; 2 Min Read</p><hr><div class=tags><div class=tag><a href=/blog/tags/c/ class=test>C</a></div><div class=tag><a href=/blog/tags/c++/ class=test>C++</a></div><div class=tag><a href=/blog/tags/development/ class=test>Development</a></div><div class=tag><a href=/blog/tags/go/ class=test>Go</a></div><div class=tag><a href=/blog/tags/tutorial/ class=test>Tutorial</a></div></div><hr><nav id=TableOfContents><ul><li><a href=#go-library>Go library</a></li><li><a href=#c-application>C++ application</a></li></ul></nav><hr><div class=content><p>This simple tutorial will show how is possible to call <a href=https://golang.org/>GoLang</a> functions from a c/c++ code.</p><p>The code written for this example is in a <a href=https://github.com/pasdam/hello-world-c-go>Github repo</a>.</p><h2 id=go-library>Go library</h2><p>First thing to do is to write the code for our <a href=https://golang.org/>Go</a> library, in this example it will just contain a simple method that will print a custom hello message based on the input.</p><p>So create a <code>main.go</code> file in your project root:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#f92672>package</span> <span style=color:#a6e22e>main</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> (
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;C&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;fmt&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>//export HelloWorld
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>HelloWorld</span>(<span style=color:#a6e22e>name</span> <span style=color:#66d9ef>string</span>) {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;Hello %s\n&#34;</span>, <span style=color:#a6e22e>name</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>main</span>() {}
</span></span></code></pre></div><p>Note the <code>//export HelloWorld</code> comment, it is used to tell the go compiler to export the specified function, so that it will be available externally.</p><p>The library must use the package <code>main</code> and have an empty <code>main</code> function, otherwise it will fail to compile.</p><p>To generate the library to use in your c/c++ code use:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>go build -buildmode<span style=color:#f92672>=</span>c-archive -o build/golib.a main.go
</span></span></code></pre></div><p>The output library will be in <code>build/golib.a</code>, the compiler will also generate an header file (<code>golib.h</code>) to include in the C++ code.</p><h2 id=c-application>C++ application</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span><span style=color:#75715e>#include</span> <span style=color:#75715e>&#34;golib.h&#34;</span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>int</span> <span style=color:#a6e22e>main</span>(<span style=color:#66d9ef>int</span> argc, <span style=color:#66d9ef>char</span> <span style=color:#f92672>**</span>argv) {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>char</span> message[] <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;World!!!&#34;</span>;
</span></span><span style=display:flex><span>  GoString goMessage <span style=color:#f92672>=</span> {message, <span style=color:#66d9ef>sizeof</span>(message)};
</span></span><span style=display:flex><span>  HelloWorld(goMessage);
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>This is a simple c++ main that includes the library and only creates a string to pass to the library method.</p><p>To build and link it against the <a href=https://golang.org/>Go</a> library just run:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>gcc -I build -pthread main.c build/golib.a -o build/test
</span></span></code></pre></div><p>The output will be the application executable <code>build/test</code>, that can be easily run:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>build/test
</span></span></code></pre></div><hr><p>Source: <a href=https://stackoverflow.com/questions/32215509/using-go-code-in-an-existing-c-project>https://stackoverflow.com/questions/32215509/using-go-code-in-an-existing-c-project</a></p></div></div></div><button class=hidden id=to-top-button onclick=goToTop() title="Go To Top">
<svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="chevron-circle-up" role="img" viewBox="0 0 512 512"><path fill="currentcolor" d="M8 256C8 119 119 8 256 8s248 111 248 248-111 248-248 248S8 393 8 256zm231-113.9L103.5 277.6c-9.4 9.4-9.4 24.6.0 33.9l17 17c9.4 9.4 24.6 9.4 33.9.0L256 226.9l101.6 101.6c9.4 9.4 24.6 9.4 33.9.0l17-17c9.4-9.4 9.4-24.6.0-33.9L273 142.1c-9.4-9.4-24.6-9.4-34 0z"/></svg>
</button>
<script async>const offset=100;var toTopButton=document.getElementById("to-top-button");window.onscroll=function(){document.body.scrollTop>offset||document.documentElement.scrollTop>offset?toTopButton.classList.remove("hidden"):toTopButton.classList.add("hidden")};function goToTop(){window.scrollTo({top:0,behavior:"smooth"})}</script></body></html>